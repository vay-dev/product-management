<div class="products-page">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Products</h1>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="fa-solid fa-plus"></i>
      Add Product
    </button>
  </div>

  <!-- Loading State -->
  @if (loading) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">Loading products...</p>
  </div>
  }

  <!-- Products Grid -->
  @if (!loading && products.length > 0) {
  <div class="products-grid">
    @for (product of products; track product.id) {
    <div class="product-card card card-hover">
      <div class="product-image-container">
        @if (product.main_image) {
        <img [src]="product.main_image" [alt]="product.name" class="product-image" />
        } @else {
        <div class="product-image-placeholder">
          <i class="fa-solid fa-image"></i>
        </div>
        }
        <span class="stock-badge" [class]="getStockStatus(product.quantity)">
          {{ getStockLabel(product.quantity) }}
        </span>
      </div>

      <div class="product-details">
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-category">
          <i class="fa-solid fa-tag"></i>
          {{ getCategoryName(product.category) }}
        </p>

        @if (product.description) {
        <p class="product-description">{{ product.description }}</p>
        }

        <div class="product-info">
          <div class="info-item">
            <span class="info-label">Price</span>
            <span class="info-value price">${{ product.price }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Quantity</span>
            <span class="info-value">{{ product.quantity }}</span>
          </div>
        </div>

        <div class="product-actions">
          <button class="btn btn-outline btn-sm" (click)="openEditModal(product)">
            <i class="fa-solid fa-edit"></i>
            Edit
          </button>
          <button class="btn btn-danger btn-sm" (click)="deleteProduct(product)">
            <i class="fa-solid fa-trash"></i>
            Delete
          </button>
        </div>
      </div>
    </div>
    }
  </div>
  }

  <!-- Empty State -->
  @if (!loading && products.length === 0) {
  <div class="empty-state">
    <i class="fa-solid fa-box-open"></i>
    <h3>No Products Yet</h3>
    <p>Get started by adding your first product</p>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <i class="fa-solid fa-plus"></i>
      Add Product
    </button>
  </div>
  }

  <!-- Product Modal -->
  @if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">{{ editMode ? 'Edit Product' : 'Add New Product' }}</h2>
        <button class="modal-close" (click)="closeModal()">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>

      <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="modal-body">
        <!-- Product Name -->
        <app-form-field
          label="Product Name"
          type="text"
          placeholder="Enter product name"
          formControlName="name"
          [required]="true"
          [errorMessage]="
            productForm.get('name')?.invalid && productForm.get('name')?.touched
              ? 'Product name is required'
              : ''
          "
        ></app-form-field>

        <!-- Category -->
        <app-form-field
          label="Category"
          type="select"
          placeholder="Select a category"
          formControlName="category"
          [options]="categoryOptions"
          [required]="true"
          [errorMessage]="
            productForm.get('category')?.invalid && productForm.get('category')?.touched
              ? 'Category is required'
              : ''
          "
        ></app-form-field>

        <!-- Description -->
        <app-form-field
          label="Description"
          type="textarea"
          placeholder="Enter product description"
          formControlName="description"
          [rows]="4"
        ></app-form-field>

        <!-- Price -->
        <app-form-field
          label="Price"
          type="number"
          placeholder="0.00"
          formControlName="price"
          [required]="true"
          [min]="0"
          [step]="0.01"
          [errorMessage]="
            productForm.get('price')?.invalid && productForm.get('price')?.touched
              ? 'Valid price is required'
              : ''
          "
        ></app-form-field>

        <!-- Quantity -->
        <app-form-field
          label="Quantity"
          type="number"
          placeholder="0"
          formControlName="quantity"
          [required]="true"
          [min]="0"
          [step]="1"
          [errorMessage]="
            productForm.get('quantity')?.invalid && productForm.get('quantity')?.touched
              ? 'Valid quantity is required'
              : ''
          "
        ></app-form-field>

        <!-- Image Upload -->
        <div class="form-field-container">
          <label class="field-label">Product Image</label>
          <div class="file-upload-container">
            <input
              type="file"
              id="productImage"
              accept="image/*"
              (change)="onFileSelected($event)"
              class="file-input"
            />
            <label for="productImage" class="file-upload-label">
              <i class="fa-solid fa-cloud-upload-alt"></i>
              <span>Choose image or drag here</span>
            </label>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-outline" (click)="closeModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="productForm.invalid">
            <i class="fa-solid fa-save"></i>
            {{ editMode ? 'Update Product' : 'Create Product' }}
          </button>
        </div>
      </form>
    </div>
  </div>
  }
</div>
